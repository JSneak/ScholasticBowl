<!DOCTYPE HTML>
<html>
	<head>
		<title>Host A New Session</title>
		<style>
        p.hidden{
            display: none;
        }
        p.visible{
            display: block;
        }
		table, th, td {
		border: 1px solid black;
		}
		</style>
		<script src="http://cdn.socket.io/socket.io-1.4.0.js"></script>
		<script>
			var PlayersInLobby= 0;
			var UserCode;
			var socket = io.connect('http://localhost:3000/')
			var Name 
			var Team
			var PermantOutput="";
			function ObtainCode()
			{
				document.getElementById("Screen2").className = "visible"
				//document.getElementById("Button1").onclick = function() { StartGame() }
				document.getElementById("Screen1").className = "hidden";
				//alert("?")
				//document.getElementById("Button1").value = "Start the game";
				document.getElementById("Useful").innerHTML = "People in Session";
				Name = document.getElementById("Name").value;
				Team = document.getElementById("NumOfTeams").value;
				var Data = {
					hostName: Name,
					hostTeam: Team
				}
				socket.emit('generate session', Data);
			}

			socket.on('recieve code',function (data) {
			UserCode = data.Code;
			document.getElementById("codeSpace").innerHTML = UserCode;
			});
			
			socket.on("displayName", function(data) {
				if(UserCode == data.Code)
				{
					PlayersInLobby++;
					document.getElementById("display").innerHTML = data.List;
				}
			});
			
			function StartGame()
			{
				var data = {
				code:UserCode
				}
				console.log(data);
				socket.emit("Start Session", data);
				document.getElementById("Button2").onclick = function(){CorrectReset()}
				document.getElementById("Screen2").className = "hidden"
				//document.getElementById("Screen3").className = "visible"
				document.getElementById("Button2").value = "Right Answer"
				document.getElementById("codeSpace").innerHTML = ""
				document.getElementById("Useful").innerHTML =""
				for(i=1;i<=Team;i++)
				{
					PermantOutput += "<th>Team"+ i + "</th>";
				}
				PermantOutput += "</tr>"
				document.getElementById("display").innerHTML = "<tr><table>"+PermantOutput+"</table>";
				//http://stackoverflow.com/questions/14949210/dynamically-update-a-table-using-javascript
			}
			
			socket.on("someone buzzed", function(data) {
				if(UserCode == data.Code)
				{
					document.getElementById("Screen2").className = "visible";
					document.getElementById("Screen3").className = "visible";
				}
			});

			function CorrectReset()//hide stuff
			{
				document.getElementById("Screen2").className = "hidden"
				document.getElementById("Screen3").className = "hidden"
				var Data = {
				code:UserCode
				}
				socket.emit("Correct Reset", Data);
				
			}
			
			function WrongReset()
			{
				document.getElementById("Screen2").className = "hidden"
				document.getElementById("Screen3").className = "hidden"
				var Data = {
				code:UserCode	
				}
				socket.emit("Wrong Reset", Data);
			}
//Make the host side to see who clicks first and reset it.
		</script>
		
	</head>
	
	<body>
	<form>
	<p id="codeSpace"></p>
	<p id="Useful"></p>
	<p id="display"></p>
	<p id="Screen1" class="visible">
	Name <br>
		<input type="text" id='Name'> <br>
	How Many Teams <br>
		<input type="number" id="NumOfTeams"> <br>
		<input type="button" value="Make Session" id="Button1" onclick="ObtainCode()">
	</p>
	<p id="Screen2" class="hidden">
	<input type="button" value="Start" id="Button2" onclick="StartGame()">
	</p>
	<p id="Screen3" class="hidden">
	<input type="button" id="Button3" value="Wrong Answer" onClick="WrongReset()">
	</p>
	<p id="displayScreen" class="visible">
	</p>
</html>
