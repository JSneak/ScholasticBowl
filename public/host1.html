<!DOCTYPE HTML>
<html>
	<head>
		<title>Host A New Session</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.97.3/css/materialize.min.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<style>
        p.hidden{
            display: none;
        }
        p.visible{
            display: block;
        }
		table, th, td {
		border: 1px solid black;
		}
		</style>
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script>//Fix for Chrome
			$(document).bind('mobileinit',function(){
			$.mobile.changePage.defaults.changeHash = false;
			$.mobile.hashListeningEnabled = false;
			$.mobile.pushStateEnabled = false;
		});
		</script>
		<script src="https://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
		<script src="https://cdn.socket.io/socket.io-1.4.0.js"></script>
		<script>
			var PlayersInLobby= 0;
			var UserCode;
			var socket = io.connect('/')
			//var socket = io.connect('http://localhost:3000/')
			var Name 
			var Team
			var PermantOutput="";
			var TeamPoints = [];
			var CurrentTeam;
			function ObtainCode()
			{
				if(document.getElementById("Name").value == "" || document.getElementById("NumOfTeams") == 0 || "")//the NumOfTeams part doesnt work
				{
					alert("No");
				}else{
					Team = document.getElementById("NumOfTeams").value;
					Name = document.getElementById("Name").value;
						for(i=0;i<Team;i++)
						{
							TeamPoints[i] = 0;
						}
						console.log(TeamPoints);
						document.getElementById("Screen1").className = "hidden"
						document.getElementById("Screen2").className = "visible"
						document.getElementById("Useful").innerHTML = "People in Session";
						var Data = {
							hostName: Name,
							hostTeam: Team
						}
						document.getElementById("Name").value = "";
						document.getElementById("NumOfTeams").value = "";
						socket.emit('Create Session', Data);
						
				}
			}
			
			socket.on('recieve code',function (data) {
			UserCode = data.Code;
			document.getElementById("codeSpace").innerHTML = UserCode + " <--- Session Code";
			});
			
			socket.on("displayName", function(data) {
				if(UserCode == data.Code)
				{
					PlayersInLobby++;
					document.getElementById("display").innerHTML = data.List;
				}
			});
			
			function StartGame()
			{
				var data = {
				code:UserCode
				}
				console.log(data);
				socket.emit("Start Session", data);
				document.getElementById("Button2").onclick = function(){CorrectReset()}
				document.getElementById("Screen2").className = "hidden"
				document.getElementById("Button2").value = "Right Answer"
				UpdateScore();
				document.getElementById("Useful").innerHTML ="Waiting for someone to buzz..."
				document.getElementById("display").innerHTML =""
				document.getElementById("Screen4").className = "visible"
			}
			
			function UpdateTable()
			{
				document.getElementById("Useful").innerHTML =""
				for(i=1;i<=Team;i++)
				{
					PermantOutput += "<th>Team"+ i + "</th>";
				}
				PermantOutput += "</tr>"
				document.getElementById("display").innerHTML = "<table><tr>"+PermantOutput+"<tr>"+"</table>";
				for(i=0;i<Team;i++)
				{
					
				}
			}
			
			function UpdateScore()
			{
			var Output =  "";
				for(i=1;i<=Team;i++)
				{
					Output += "Team " + i + ": " + TeamPoints[i-1] + "<br>"
				}
				document.getElementById("codeSpace").innerHTML = Output
			}
			
			
			socket.on("someone buzzed", function(data) {
				if(UserCode == data.Code)
				{
					CurrentTeam = data.PlayerTeam;
					document.getElementById("Useful").innerHTML = ""
					document.getElementById("display").innerHTML = data.PlayerName +" from Team " + data.PlayerTeam + " buzzed in."; 
					document.getElementById("Screen2").className = "visible";
					document.getElementById("Screen3").className = "visible";
					document.getElementById("Screen4").className = "hidden"
					var BuzzSound = new Audio("buzz.mp3");
					BuzzSound.play();
				}
			});
			function CorrectReset()//hide stuff
			{
				TeamPoints[CurrentTeam-1]++;
				UpdateScore();
				document.getElementById("display").innerHTML = ""; 
				document.getElementById("Useful").innerHTML ="Waiting for someone to buzz..."
				document.getElementById("Screen2").className = "hidden"
				document.getElementById("Screen3").className = "hidden"
				document.getElementById("Screen4").className = "visible"
				var Data = {
				code:UserCode
				}
				socket.emit("Correct Reset", Data);
				var BuzzSound = new Audio("Fake.mp3");
                BuzzSound.play();
				
			}
			
			function WrongReset()
			{
				document.getElementById("display").innerHTML = ""; 
				document.getElementById("Useful").innerHTML ="Waiting for someone to buzz..."
				document.getElementById("Screen2").className = "hidden"
				document.getElementById("Screen3").className = "hidden"
				document.getElementById("Screen4").className = "visible"
				var Data = {
				code:UserCode	
				}
				socket.emit("Wrong Reset", Data);
				var BuzzSound = new Audio("Price.mp3");
                BuzzSound.play();
			}
			
			function EndSession()
			{
				var data = {
				code:UserCode
				}
				socket.emit("End Session", data);
				socket.disconnect();
				location.reload();
			}
//Make the host side to see who clicks first and reset it.





function addCell(){
	var newStu;
	newStu = "<tr><td><div class='ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset'><input type = 'text' placeholder = 'Student Name...'></input></div></td></tr>";
	
	$("#stuBod").append(newStu);
	
	$("#stuBod").find("input:last").on("keyup", function(){
		cellListener($(this));
	});
}

function removeCell(cur){
	if(cur.val() == ""){
		if(cur.parentsUntil("tbody").next().find("input").val() == ""){
			cur.parentsUntil("tbody").next().remove();
			cur.off("keyup");
			cur.on("keyup", function(){
				cellListener(cur);
			})
		}else{
			cur.parentsUntil("tbody").remove();
		}
	}
}
			
//Change the if statement to check the number
function cellListener(cell){
	if(cell.val() != ""){
		cell.off("keyup");
		cell.on("keyup", function(){
			removeCell(cell);
		})
		addCell();
	}
}

//Change #stuBod to the groupNum
$(function(){
	$("#stuBod").find("input:last").on("keyup", function(){
		cellListener($(this));
	});
})//End of list of students

		</script>
		
	</head>
	
	<body>
	<form>
	<p id="codeSpace"></p>
	<p id="Useful"></p>
	<p id="display"></p>
	<p id="Screen1" class="visible">
	Name <br>
		<input type="text" id='Name'> <br>
	How Many Teams <br>
		<input type="number" id="NumOfTeams"> <br>
		<input type="button" value="Make Session" id="Button1" onclick="ObtainCode()"class="waves-effect waves-light btn-large">
	</p>
	<p id="Screen2" class="hidden">
	<input type="button" value="Start" id="Button2" onclick="StartGame()"class="waves-effect waves-light btn-large">
	</p>
	<p id="Screen3" class="hidden">
	<input type="button" id="Button3" value="Wrong Answer" onClick="WrongReset()"class="'waves-effect waves-light btn-large red lighten-1'">
	</p>
	<p id="Screen4" class="hidden">
	<input type="button" value="End Session" id="EndButton" onClick="EndSession()"class='waves-effect waves-light btn-large red lighten-1'>
	</p>
	<p id="displayScreen" class="visible">
	</p>
<!-- DIVIDE BETWEEN CHOI'S CODE AND MINE -->	
	<form id = 'studFrm'>
	<label for = 'stuTab' class = 'ui-hidden-accessible'>Student Table</label>
	<table data-role = 'table' class = 'ui-responsive'>
		<thead>
			<tr>
				<th>Student Name</th><!--
				<th>Student Information</th>-->
			</tr>
		</thead>
		<tbody id = 'stuBod'>
			<tr>
				<td>
					<input type = 'text' placeholder = 'Student Name...'></input>
				</td><!--
				<td>
					<button class = 'ui-btn ui-shadow ui-corner-all'>MORE INFO</button>
				</td>-->
			</tr>
		</tbody>
	</table>
</form><br/>
<form id = 'groupFrm'>
	<label for = 'groupNum' class = 'ui-hidden-accessible'>Number of Groups</label>
	<input type  = 'number' id = 'groupNum' min = '2' placeholder = 'Number of People per Group...'></input><br/>
</form>
</html>
